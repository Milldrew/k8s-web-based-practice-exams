version: '3.8'

services:
  kind-web-terminal:
    build: .
    container_name: kind-web-terminal
    ports:
      - "3000:3000"      # Express server
      - "2222:2222"      # SSH to control-plane node
      - "2223:2223"      # SSH to worker node
    # Need privileged mode for Docker-in-Docker
    privileged: true
    volumes:
      # Persist Kind cluster data and Docker data inside the container
      - kind-data:/var/lib/docker
      - kube-data:/root/.kube
    environment:
      - PORT=3000
      - NODE_ENV=production
      - DOCKER_TLS_CERTDIR=/certs
    restart: unless-stopped
    # Storage driver for DinD
    security_opt:
      - seccomp=unconfined
    tmpfs:
      - /tmp

volumes:
  kind-data:
    driver: local
  kube-data:
    driver: local
